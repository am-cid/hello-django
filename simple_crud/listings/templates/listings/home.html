{% extends "listings/base.html" %}
{% load highlight %}

{% block content %}

<!-- Search -->
<form method="GET" action="{% url 'home' %}" class="w-full max-w-4xl mb-6 mt-8">
  <div class="relative">
      <!-- Search Input -->
      <input 
          type="text" 
          name="q" 
          value="{{ query }}" 
          placeholder="Search listings..." 
          class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md pl-3 pr-28 py-2 transition duration-300 ease-in-out focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow"
      />

      <button 
          class="absolute top-1 right-1 flex items-center rounded bg-white py-1 px-2.5 border border-gray-300 text-black text-center text-sm transition-all shadow-sm hover:bg-gray-100 focus:bg-gray-200 focus:shadow-none active:bg-gray-200 hover:shadow active:shadow-none disabled:pointer-events-none disabled:opacity-50" 
          type="submit"
      >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 mr-2 text-black">
              <path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd" />
          </svg>
          Search
      </button>

  </div>
</form>



{% if listings %}
<ul>
  {% for listing in listings %}
  <li>
    <strong>
      <a href="{% url 'listing_detail' listing.pk %}">{{ listing.name|highlight:query  }}</a>
    </strong>
    - ${{ listing.price }} by 
    <a href="{% url 'profile' listing.seller.username %}">{{ listing.seller.username }}</a>
    <br />
    {{ listing.description|highlight:query }}
    <br />
    {% if user.is_authenticated and user == listing.seller %}
      <a href="{% url 'listing_update' listing.pk %}">Edit</a> |
      <a href="{% url 'listing_delete' listing.pk %}">Delete</a>
    {% endif %}
  </li>
  <br />
  {% endfor %}
</ul>
{% else %}
  <p class="text-center text-gray-500 italic opacity-70 mt-6">
    No listings found
  </p>
{% endif %}

{% if user.is_authenticated %}
    <a href="{% url 'listing_create' %}">Create New Listing</a>
{% endif %}
{% endblock %}
